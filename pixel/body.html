<style type="text/css">
  .embeddedServiceHelpButton .helpButton .uiButton {
    background-color: #005290;
    font-family: "Arial", sans-serif;
  }
  .embeddedServiceHelpButton .helpButton .uiButton:focus {
    outline: 1px solid #005290;
  }
</style>

<script type="text/javascript">
  let email = "";
  let firstName = "";
  let company = "";
  let lastName = "";
  let auth;
  __RENDER_8_SESSION__.sessionPromise.then((value) => {
    auth = value.response.namespaces.profile.isAuthenticated.value;

    if (auth === "false") {
      console.log("Guest user");
      console.log("guest Auth", auth);
      console.log(email);

      var initESW = function (gslbBaseURL) {
        embedded_svc.settings.displayHelpButton = true; //Or false
        embedded_svc.settings.language = ""; 

        embedded_svc.settings.enabledFeatures = ["LiveAgent"];
        embedded_svc.settings.entryFeature = "LiveAgent";

        embedded_svc.init(
          "https://engfast--chatboten.my.salesforce.com",
          "https://chatboten-stanleyengineeredfastening.cs214.force.com/PartnerPortal",
          gslbBaseURL,
          "00D790000004car",
          "{{settings.guessedAccountName}}",
          {
            baseLiveAgentContentURL:
              "https://c.la5-c1cs-ia5.salesforceliveagent.com/content",
            deploymentId: "5727V000000XZC3",
            buttonId: "5737V000000XZK7",
            baseLiveAgentURL:
              "https://d.la5-c1cs-ia5.salesforceliveagent.com/chat",
            eswLiveAgentDevName:
              "EmbeddedServiceLiveAgent_Parent04I79000000000aEAA_17d960c557b",
            isOfflineSupportEnabled: false,
          }
        );
      };

      if (!window.embedded_svc) {
        var s = document.createElement("script");
        s.setAttribute(
          "src",
          "https://engfast--chatboten.my.salesforce.com/embeddedservice/5.0/esw.min.js"
        );
        s.onload = function () {
          initESW(null);
        };
        document.body.appendChild(s);
      } else {
        initESW("https://service.force.com");
      }

      // For logged-in user
    } else {
      email = value.response.namespaces.profile.email.value;
      firstName = value.response.namespaces.profile.firstName.value;
      lastName = value.response.namespaces.profile.lastName.value;

      console.log(value.response.namespaces.profile.email.value);
      console.log(value.response.namespaces.profile.firstName.value);
      console.log(value.response.namespaces.profile.lastName.value);

      console.log("Logged User");
      console.log(email);
      var callback = function () {
        // Handler when the DOM is fully loaded
        var initESW = function (gslbBaseURL) {
          embedded_svc.settings.displayHelpButton = true;
          if ("{{settings.language}}" != "") {
            embedded_svc.settings.language = window.decodeURIComponent(
              "{{settings.language}}"
            );
          }
          if ("{{settings.defaultMinimizedText}}" != "") {
            //(Toma como valor predeterminado Sesión de chat con un experto)
            embedded_svc.settings.defaultMinimizedText =
              window.decodeURIComponent("{{settings.defaultMinimizedText}}");
          }
          if ("{{settings.disabledMinimizedText}}" != "") {
            //(Toma como valor predeterminado Agente sin conexión)
            embedded_svc.settings.disabledMinimizedText =
              window.decodeURIComponent("{{settings.disabledMinimizedText}}");
          }
          if ("{{settings.loadingText}}" != "") {
            //(Toma como valor predeterminado Cargando)
            embedded_svc.settings.loadingText = window.decodeURIComponent(
              "{{settings.loadingText}}"
            );
          }

          var enabledFeatures = window.decodeURIComponent(
            "{{settings.enabledFeatures}}"
          );
          embedded_svc.settings.enabledFeatures = JSON.parse(enabledFeatures);
          embedded_svc.settings.entryFeature = "{{settings.entryFeature}}";

          embedded_svc.settings.prepopulatedPrechatFields = {
            FirstName: firstName,
            LastName: lastName,
            Company: "HCLTECH",
            Email: email,
          };
          embedded_svc.init(
            window.decodeURIComponent("{{settings.baseCoreURL}}"),
            window.decodeURIComponent("{{settings.communityEndpointURL}}"),
            gslbBaseURL,
            "{{settings.organizationId}}",
            "{{settings.loggedAccountName}}",
            {
              baseLiveAgentContentURL:
                "https://c.la5-c1cs-ia5.salesforceliveagent.com/content",
              deploymentId: "{{settings.deploymentId}}",
              buttonId: "{{settings.buttonId}}",
              baseLiveAgentURL:
                "https://d.la5-c1cs-ia5.salesforceliveagent.com/chat",
              eswLiveAgentDevName: "{{settings.eswLiveAgentDevName}}",
              isOfflineSupportEnabled: "{{settings.isOfflineSupportEnabled}}",
            }
          );
        };

        if (!window.embedded_svc) {
          var s = document.createElement("script");
          s.setAttribute(
            "src",
            "https://engfast--chatboten.my.salesforce.com/embeddedservice/5.0/esw.min.js"
          );
          s.onload = function () {
            initESW(null);
          };
          document.body.appendChild(s);
        } else {
          initESW("https://service.force.com");
        }
      };

      if (
        document.readyState === "complete" ||
        (document.readyState !== "loading" &&
          !document.documentElement.doScroll)
      ) {
        callback();
      } else {
        document.addEventListener("DOMContentLoaded", callback);
      }
    }
  });
</script>
